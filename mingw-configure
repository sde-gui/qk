#!/bin/sh

if [ -z $GTK_PREFIX ]; then
    export GTK_PREFIX=/usr/local/win/gtk
fi
export PKG_CONFIG_PATH=$GTK_PREFIX/lib/pkgconfig
export PKG_CONFIG_LIBDIR=$GTK_PREFIX/lib/pkgconfig

############################################################################

if [ x`basename $0` = xfake-pkg-config ]; then
    if [ "x$1" = "x--atleast-pkgconfig-version" ]; then
        exec /usr/bin/pkg-config --atleast-pkgconfig-version $2
    else
        exec /usr/bin/pkg-config --define-variable=prefix=$GTK_PREFIX $*
    fi
fi

############################################################################

if [ x$CONFIGURE = x ]; then
    CONFIGURE="configure"
    if [ ! -e $CONFIGURE ]; then
        CONFIGURE=`dirname $0`/configure
    fi
    if [ ! -e $CONFIGURE ]; then
        echo "Can't find configure script"
        exit 1
    fi
    configure_dir=`dirname "$CONFIGURE"`
    configure_dir=`cd "$configure_dir" && pwd`
    CONFIGURE="$configure_dir"/configure
fi

export ADDR2LINE="/usr/bin/i586-mingw32msvc-addr2line"
export AR="/usr/bin/i586-mingw32msvc-ar"
export AS="/usr/bin/i586-mingw32msvc-as"
export CC="/usr/bin/i586-mingw32msvc-gcc"
export CPP="/usr/bin/i586-mingw32msvc-cpp"
export CPPFILT="/usr/bin/i586-mingw32msvc-c++filt"
export CXX="/usr/bin/i586-mingw32msvc-g++"
export DLLTOOL="/usr/bin/i586-mingw32msvc-dlltool"
export DLLWRAP="/usr/bin/i586-mingw32msvc-dllwrap"
export GCOV="/usr/bin/i586-mingw32msvc-gcov"
export LD="/usr/bin/i586-mingw32msvc-ld"
export NM="/usr/bin/i586-mingw32msvc-nm"
export OBJCOPY="/usr/bin/i586-mingw32msvc-objcopy"
export OBJDUMP="/usr/bin/i586-mingw32msvc-objdump"
export RANLIB="/usr/bin/i586-mingw32msvc-ranlib"
export READELF="/usr/bin/i586-mingw32msvc-readelf"
export SIZE="/usr/bin/i586-mingw32msvc-size"
export STRINGS="/usr/bin/i586-mingw32msvc-strings"
export STRIP="/usr/bin/i586-mingw32msvc-strip"
export WINDRES="/usr/bin/i586-mingw32msvc-windres"

export CPATH=$GTK_PREFIX/include
export LDFLAGS="-L$GTK_PREFIX/lib $LDFLAGS"
export CFLAGS="${CFLAGS:-"-O2 -g"} -I$GTK_PREFIX/include -mms-bitfields -march=i686"
export CXXFLAGS="${CFLAGS:-"-O2 -g"} -I$GTK_PREFIX/include -mms-bitfields -march=i686"

export PATH=$MINGW_BIN:/usr/i586-mingw32msvc/bin:$PATH

if [ -L fake-pkg-config ]; then
    rm fake-pkg-config
fi
ln -s $0 fake-pkg-config
export PKG_CONFIG="./fake-pkg-config"

TARGET=i586-pc-mingw32msvc

exec sh $CONFIGURE --target=$TARGET --host=$TARGET --enable-all-gcc-warnings $*
