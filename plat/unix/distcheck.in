#! /bin/sh

docmd() {
  echo "$@"
  "$@" || exit $!
}

top_builddir=`pwd`
top_testdir=`mktemp --tmpdir -d medit-distcheck-XXXXXXXX`
package=medit-${MOO_VERSION}

docmd make package_source
docmd cp $package.tar.bz2 $top_testdir/

docmd cd $top_testdir
docmd tar xjf $package.tar.bz2
docmd mkdir _install
docmd cd $package
docmd cmake -D CMAKE_INSTALL_PREFIX=$top_testdir/_install .
docmd make -j 3 all
docmd make install
docmd cd $top_testdir
docmd rm -fr $package _install

docmd cd $top_testdir
docmd tar xjf $package.tar.bz2
docmd mkdir _install
docmd mkdir _build
docmd cd _build
docmd cmake -D CMAKE_INSTALL_PREFIX=$top_testdir/_install $top_testdir/$package
docmd make -j 3 all
docmd make install clean
docmd make all install
docmd cd $top_testdir
docmd rm -fr $package _install _build

docmd rm -fr $top_testdir
echo " *** SUCCESS *** "
